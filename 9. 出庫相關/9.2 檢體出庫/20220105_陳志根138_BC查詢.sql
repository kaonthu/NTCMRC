CREATE TABLE kao_practice_6.`20220105_陳志根138_BC查詢` (
  `row_names` int NOT NULL auto_increment,
  `CMRC_id` varchar(20) DEFAULT NULL,
  PRIMARY KEY (`row_names`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1;

INSERT INTO kao_practice_6.`20220105_陳志根138_BC查詢` (CMRC_id) 
VALUES 
("A82015U20919N0035"),
("N02017Q61125I0074"),
("X82015O10919S3074"),
("Q62013S90915V2025"),
("W12014W70628E1075"),
("U12015J00919E5052"),
("P52014P11213E4082"),
("I82013R80915S6020"),
("X62014E60914A9009"),
("Y12015J31003O0053"),
("G42016Z20130N4073"),
("W62018Y70310R5070"),
("I02013T11214F5043"),
("A92014I31108N4052"),
("O82018U90505J6058"),
("G62015F91107W2080"),
("A22018U70421A1073"),
("Y62018P20324V5067"),
("G32016N50117O6028"),
("H12014F60611F6071"),
("P32014I30730B3005"),
("K02016Y50130C4081"),
("M62015O61107A5035"),
("G82014W50611R9083"),
("G02015D10718F3117"),
("B32018X10421A1070"),
("Y42014L60608Z9006"),
("K92014C71108Q6051"),
("O62014O20608D3021"),
("L02015A11107F5040"),
("G12018T50505Y7061"),
("E82014A70611F6029"),
("D72017A00304F1076"),
("Z82016N20305Z8047"),
("I32017M00422T5002"),
("V12016E20305D5034"),
("J32014A01220M3013"),
("W72015K50509Q8057"),
("Z92015Q80509D1010"),
("A52015P31107X9052"),
("D22016W80305W1060"),
("M72013X51214O1065"),
("E62016W90507T6011"),
("U22016Y80409Q1008"),
("T72018R40609L5028"),
("Z32014H90408V5021"),
("N62016T50515K9119"),
("J22014H70408U1042"),
("X52014M10408L2041"),
("U22015I70411R4035"),
("Q52015D90411N3036"),
("K72017Q90325F0068"),
("G92014W91018X7040"),
("U92014Z20412N5063"),
("V82014K90118N3005"),
("Z12014N70420E5012"),
("M22014C20420N8013"),
("E82017H70715R0022"),
("D42017A80715E8023"),
("X02014G70615Z3080"),
("J32018U00927Z4079"),
("W72018X01027E2017"),
("Q02018O71027P5065"),
("F72018A51027G6058"),
("X02014U00719R6117"),
("Y82016N00930R3027"),
("V52016R91029O0024"),
("O82013X81102J6022"),
("D62013B01102S6058"),
("V02018D41120E4033"),
("C52018K71120Z6053"),
("C02013B10810O0115"),
("W72016L40813E6053"),
("R42015O21017B9041"),
("O12014U10719F9083"),
("F22019T00112R2062"),
("K02014L11213C6038"),
("K92019S60112A9056"),
("U82014H21213A7100"),
("B8M080W1004N2"),
("U0M080V2005S3"),
("K92015V80124W5043"),
("Y22014W60705W4046"),
("F7M080X6006A5"),
("E2M080L9007A0"),
("H5M080I4008T2"),
("T4M080V1009Y0"),
("F52016G40220R3114"),
("D0M080C8001B9"),
("U0M080D1002H1"),
("K22018Q70602O3045"),
("Q12016A00305R0067"),
("V5M080P9004W9"),
("T82014R40118D9054"),
("R5M080F2009H7"),
("I7M080K5010H1"),
("R82019B80921B2063"),
("Y9M080Z1012F4"),
("Y12013F31214F2022"),
("L52016S40117P9085"),
("I1M080M3015O6"),
("H0M080P7017Y9"),
("Y22019I70921B7062"),
("I4M080Z9018T9"),
("I6M080K7014J6"),
("I9M080Z0019Y3"),
("N0M080P6020E8"),
("H1M080L3022O8"),
("K6M080T9023Z7"),
("E8M08AX4001J4"),
("N0M08AP1002U3"),
("B4M08AD6003M5"),
("A5M08AX5005H9"),
("Z02013M60915I9057"),
("N82018F80303Z9083"),
("X72015K61107P2074"),
("J32013D91108Q1101"),
("U02015U70509U2062"),
("M8M08AE7009G2"),
("H22015U50718E8019"),
("Y5M080W1001I3"),
("R0M080T2002G8"),
("Q32016W80515A8118"),
("I3M080P8003N5"),
("Y92014H50322X7037"),
("O3M080N6006V1"),
("D22020W71024I6080"),
("F82020J01024W3079"),
("N8M08AG8016F5"),
("J22014H70118U8066"),
("Q82014D30517N0072"),
("X92018E71012K5027"),
("M22014L50719A7107"),
("T92013K91130P2115"),
("N7M10AW1001I5"),
("Z7M080O8001H0"),
("T0M080D2002L5"),
("Y62014T10408Q9002");

SELECT d,count(*) FROM
(
SELECT max(data_exam) as d,a.*
FROM kao_practice_6.`20220105_陳志根138_BC查詢` as a
LEFT JOIN CMRC_DB_kaonthu.CMRC_all_persontimes_20220110_kaonthu as b
ON a.CMRC_id = b.CMRC_id
GROUP BY a.CMRC_id
) as t1
GROUP BY left(d,4);

SELECT count(*),left(data_exam,4) as t1,a.*,b.* FROM kao_practice_6.`20220105_陳志根138_BC查詢` as a
INNER JOIN CMRC_DB_kaonthu.CMRC_all_persontimes_20220110_kaonthu as b
ON a.CMRC_id = b.CMRC_id
GROUP BY left(data_exam,4);

SELECT a.*,b.* FROM kao_practice_6.`20220105_陳志根138_BC查詢` as a
INNER JOIN CMRC_DB_kaonthu.CMRC_all_persontimes_20220110_kaonthu as b
ON a.CMRC_id = b.CMRC_id
WHERE data_exam > 20210300
AND a.CMRC_ID not IN (SELECT `對回去的CMRC_id` FROM CMRC_DB.`2021年送BC抽DNA_152管資料_kaonthu`
WHERE `最後一次來時間` >= 20210300);

SELECT a.*,b.* FROM kao_practice_6.`20220105_陳志根138_BC查詢` as a
INNER JOIN kao_practice_5.CMRC_DNA_DB_kaonthu_back_DNA_consent as b
ON a.CMRC_id = b.CMRC_id
GROUP BY a.CMRC_id; #申請138名單有 103個有 DNA庫存 有無條件? 沒有

SELECT a.*,b.* FROM kao_practice_6.`20220105_陳志根138_BC查詢` as a
INNER JOIN CMRC_DB.dr_chen_BC_20210811 as b
ON a.CMRC_id = b.CMRC_id
GROUP BY a.CMRC_id; #申請138名單有685人次 77個人 dr_chen_BC_20210811條件 

SELECT a.*,b.* FROM kao_practice_6.`20220105_陳志根138_BC查詢` as a
INNER JOIN CMRC_DB.CMRC_BC_extraction_DB as b
ON a.CMRC_id = b.CMRC_id
GROUP BY a.CMRC_id; #申請138名單有129人次 65個人 CMRC_BC_extraction_DB條件 

############################################

SELECT a.*,b.* FROM kao_practice_6.`20220105_陳志根138_BC查詢` as a
INNER JOIN CMRC_DB_kaonthu.Sample_info_joint_status as b
ON a.CMRC_id = b.CMRC_id
GROUP BY a.CMRC_id; #申請138名單有155人次 31個人 CMRC_DB.CMRC_Sample_info條件 

CREATE TABLE CMRC_DB_kaonthu.BC_info_joint_not_out_site_not_NULL as 
SELECT t1.*,t2.Fridge,t2.Box,t2.Site,t2.`out`,t2.out_appl_time,t2.out_time,t2.out_name,t2.entry_time
FROM
(SELECT * FROM CMRC_DB.CMRC_Sample_info
WHERE Specimen = "BC") as t1
INNER JOIN CMRC_DB.CMRC_Sample_status as t2
ON t1.C_number = t2.C_number
WHERE (`out` = 0 or `out_name` = "徐于喬" )and Box is not NULL;


SELECT t1.*,t2.* FROM
(SELECT * FROM CMRC_DB.CMRC_Sample_info
WHERE Specimen = "BC") as t1
INNER JOIN CMRC_DB.CMRC_Sample_status as t2
ON t1.C_number = t2.C_number
WHERE (`out` = 0 or `out_name` = "徐于喬" )and Box is not NULL;

#############################################################
SELECT a.*,b.* FROM kao_practice_6.`20220105_陳志根138_BC查詢` as a
INNER JOIN CMRC_DB_kaonthu.CMRC_all_persontimes_20220110_kaonthu as b
ON a.CMRC_id = b.CMRC_id
WHERE data_exam > 20210300
AND a.CMRC_ID not IN (SELECT `對回去的CMRC_id` FROM CMRC_DB.`2021年送BC抽DNA_152管資料_kaonthu`
WHERE `最後一次來時間` >= 20210300);

CREATE TEMPORARY TABLE `20220105_陳志根55管` as
SELECT a.* FROM kao_practice_6.`20220105_陳志根138_BC查詢` as a
INNER JOIN CMRC_DB_kaonthu.CMRC_all_persontimes_20220110_kaonthu as b
ON a.CMRC_id = b.CMRC_id
WHERE data_exam > 20210300
AND a.CMRC_ID not IN (SELECT `對回去的CMRC_id` FROM CMRC_DB.`2021年送BC抽DNA_152管資料_kaonthu`
WHERE `最後一次來時間` >= 20210300);

SELECT a.*,b.* FROM CMRC_DB_kaonthu.CMRC_DNA_DB_kaonthu_back_DNA_consent as a
INNER JOIN (SELECT CMRC_id FROM
kao_practice_6.`20220105_陳志根138_BC查詢`
WHERE CMRC_id not IN (
SELECT CMRC_id FROM `20220105_陳志根55管`)) as b
ON a.CMRC_id = b.CMRC_id
WHERE DNA_yes regexp '1'
GROUP BY a.CMRC_id; 





